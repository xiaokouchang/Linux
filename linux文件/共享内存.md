@[TOC](æ–‡ ç«  ç›® å½•)
>ğŸ’»ä½œ è€… ç®€ ä»‹ï¼šæ›¾ ä¸ ä½  ä¸€ æ · è¿· èŒ«ï¼Œç° ä»¥ ç» éªŒ åŠ© ä½  å…¥ é—¨ Linuxã€‚
>ğŸ’¡ä¸ª äºº ä¸» é¡µï¼š[@ç¬‘å£å¸¸å¼€xpr çš„ ä¸ª äºº ä¸» é¡µ](https://blog.csdn.net/2301_78847073?spm=1000.2115.3001.5343)
>ğŸ“šç³» åˆ— ä¸“ æ ï¼š[Linux æ¢ ç´¢ ä¹‹ æ—…ï¼šä» å‘½ ä»¤ è¡Œ åˆ° ç³» ç»Ÿ å†… æ ¸](https://blog.csdn.net/2301_78847073/category_13024932.html)
>âœ¨ä»£ ç  è¶£ è¯­ï¼šé™ æ€ åº“ æ˜¯ è£… æ»¡ å·¥ å…· çš„ ç®± å­ï¼Œç¼– è¯‘ æ—¶ å…¨ å¡ ç¨‹ åºï¼Œæ–¹ ä¾¿ ä½† æ²‰ï¼›åŠ¨ æ€ åº“ æ˜¯ å…± äº« æ¶ï¼Œè®° ä½ ç½®ï¼Œæ²¡ å·¥ å…· å°± å¡ å£³ã€‚
>ğŸ’ªä»£ ç  åƒ è¡Œï¼Œå§‹ äº åš æŒï¼Œæ¯ æ—¥ æ•² ç ï¼Œè¿› é˜¶ ç¼– ç¨‹ ä¹‹ è·¯ã€‚
>ğŸ“¦gitee é“¾ æ¥ï¼š[gitee](https://gitee.com/xiaokouchangkai123)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/fc8d52ed792a4cec88378dd286938beb.gif)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ Linux C/C++ å¼€ å‘ ä¸­ï¼Œåº“ æ˜¯ ä»£ ç  å¤ ç”¨ å’Œ å·¥ ç¨‹ åŒ– çš„ æ ¸ å¿ƒã€‚ä¸ å°‘ å¼€ å‘ è€… ä¼š é‡ åˆ° æº ç  æ³„ éœ²ã€ç¼– è¯‘ â€œæ‰¾ ä¸ åˆ° å¤´ æ–‡ ä»¶ / åº“â€ã€åŠ¨ æ€ åº“ è¿ è¡Œ åŠ  è½½ å¤± è´¥ ç­‰ é—® é¢˜ï¼Œæœ¬ è´¨ æ˜¯ å¯¹ åº“ çš„ æµ ç¨‹ ä¸ ç†Ÿ æ‚‰ã€‚æœ¬ æ–‡ ä» èƒŒ æ™¯ åˆ‡ å…¥ï¼Œå…ˆ è®² é™ æ€ åº“ çš„ åŸ ç†ã€åˆ¶ ä½œ ä¸ ä½¿ ç”¨ï¼Œå† è®² åŠ¨ æ€ åº“ çš„ å® æˆ˜ æŠ€ å·§ï¼Œå¸® ä½  æŒ æ¡ åº“ çš„ å…¨ æµ ç¨‹ åº” ç”¨ã€‚
***
# å…± äº« å†… å­˜
## ç›´ æ¥ åŸ ç†
è¿› ç¨‹ é—´ é€š ä¿¡ çš„ æœ¬ è´¨ æ˜¯ å…ˆ è®© ä¸ åŒ çš„ è¿› ç¨‹ çœ‹ åˆ° åŒ ä¸€ ä»½ èµ„ æºã€‚å…± äº« å†… å­˜ åŒº æ˜¯ æœ€ å¿« çš„ IPC å½¢ å¼ã€‚ä¸€ æ—¦ è¿™ æ · çš„ å†… å­˜ æ˜  å°„ åˆ° å…± äº« å®ƒ çš„ è¿› ç¨‹ çš„ åœ° å€ ç©º é—´ï¼Œè¿™ äº› è¿› ç¨‹ é—´ æ•° æ® ä¼  é€’ ä¸ å† æ¶‰ åŠ åˆ° å†… æ ¸ï¼Œè¿› ç¨‹ ä¸ å† é€š è¿‡ æ‰§ è¡Œ è¿› å…¥ å†… æ ¸ çš„ ç³» ç»Ÿ è°ƒ ç”¨ æ¥ ä¼  é€’ å½¼ æ­¤ çš„ æ•° æ®ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/713676ec31a24f5a960aeec1872dc27b.png)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/fa28777d109b43269774001caec723e0.png)
**shmget**
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/60550af6156c4cb7833282cc867ce47a.png)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/35695be8212b4600bca2c28d4d9c6eb6.png)
**IPC_CREATï¼ˆå• ç‹¬ï¼‰**ï¼šå¦‚ æœ ç”³ è¯· çš„ å…± äº« å†… å­˜ ä¸ å­˜ åœ¨ï¼Œå°± åˆ› å»ºï¼Œå­˜ åœ¨ å°± è· å– å¹¶ è¿” å›ã€‚

**IPC_CREAT | IPC_EXCL**ï¼šå¦‚ æœ ç”³ è¯· çš„ å…± äº« å†… å­˜ ä¸ å­˜ åœ¨ï¼Œå°± åˆ› å»ºï¼Œå­˜ åœ¨ å°± å‡º é”™ å¹¶ è¿” å›ã€‚å¦‚ æœ ç”³ è¯· æˆ åŠŸ äº† ä¸€ ä¸ª å…± äº« å†… å­˜ï¼Œè¿™ ä¸ª å…± äº« å†… å­˜ ä¸€ å®š æ˜¯ ä¸€ ä¸ª æ–° çš„ã€‚IPC_EXCL ä¸ å• ç‹¬ ä½¿ ç”¨ã€‚

**Key**
1. key æ˜¯ ä¸€ ä¸ª æ•° å­—ï¼Œè¿™ ä¸ª æ•° å­— æ˜¯ å‡  ä¸ é‡ è¦ï¼Œå…³ é”® åœ¨ äº å®ƒ å¿… é¡» åœ¨ å†… å­˜ ä¸­ å…· æœ‰ å”¯ ä¸€ æ€§ï¼Œèƒ½ å¤Ÿ è®© ä¸ åŒ çš„ è¿› ç¨‹ è¿› è¡Œ å”¯ ä¸€ æ€§ æ ‡ è¯†ï¼Œç”¨ æ¥ ç¡® å®š å…± äº« å†… å­˜ æ˜¯ å¦ å­˜ åœ¨ã€‚
2. ç¬¬ 1 ä¸ª è¿› ç¨‹ å¯ ä»¥ é€š è¿‡ key åˆ› å»º å…± äº« å†… å­˜ï¼Œç¬¬ äºŒ ä¸ª ä»¥ å çš„ è¿› ç¨‹ï¼Œåª è¦ æ‹¿ ç€ åŒ ä¸€ ä¸ª key å°± å¯ ä»¥ å’Œ ç¬¬ ä¸€ ä¸ª è¿› ç¨‹ çœ‹ åˆ° åŒ ä¸€ ä¸ª å…± äº« å†… å­˜ã€‚
3. å·² ç» åˆ› å»º çš„ å…± äº« å†… å­˜ï¼Œkey åœ¨ å…± äº« å†… å­˜ çš„ æ è¿° å¯¹ è±¡ ä¸­ã€‚
4. ç¬¬ ä¸€ æ¬¡ åˆ› å»º çš„ æ—¶ å€™ï¼Œå¿… é¡» è¦ æœ‰ ä¸€ ä¸ª key äº†ï¼Œ
5. key ç±» ä¼¼ äº å‘½ å ç®¡ é“ ä¸­ çš„ è·¯ å¾„ + æ–‡ ä»¶ çš„ æ“ ä½œã€‚

**ftok**
è¿” å› keyã€‚ftok æ˜¯ ä¸€ å¥— ç®— æ³•ï¼Œå¯¹ pathname å’Œ proj_id è¿› è¡Œ äº† æ•° å€¼ è®¡ ç®— å³ å¯ã€‚pathname å’Œ proj_id ç”± ç”¨ æˆ· çº¦ å®š çš„ã€‚key ä¹Ÿ å¯ ä»¥ ç”± æ“ ä½œ ç³» ç»Ÿ ç”Ÿ æˆï¼Œä½† æ˜¯ æ“ ä½œ ç³» ç»Ÿ ä¸ çŸ¥ é“ å“ª ä¸¤ ä¸ª è¿› ç¨‹ è¦ è¿› è¡Œ é€š ä¿¡ï¼Œæ—  æ³• è¿› è¡Œ ä¼  é€’ã€‚


![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/72d49e4406b84e6f910b16fdd22c9a44.png)
**log.hpp**
```javascript
#pragma once

#include <iostream>
#include <time.h>
#include <stdarg.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdlib.h>
using namespace std;
#define SIZE 1024
//æ—¥å¿—å±é™©ç­‰çº§
#define Info 0
#define Debug 1
#define Warning 2
#define Error 3
#define Fatal 4

//æ—¥å¿—æ˜¾ç¤º
#define Screen 1
#define Onefile 2
#define Classfile 3
//æ—¥å¿—å­˜æ”¾ä½ç½®
#define LogFile "log.txt"

class Log
{
public:
    Log()
    {
        printMethod = Screen;
        path = "./log/";
    }
    void Enable(int method)
    {
        printMethod = method;
    }
    std::string levelToString(int level)
    {
        switch (level)
        {
        case Info:
            return "Info";
        case Debug:
            return "Debug";
        case Warning:
            return "Warning";
        case Error:
            return "Error";
        case Fatal:
            return "Fatal";
        default:
            return "None";
        }
    }

    // void logmessage(int level, const char *format, ...)
    // {
    //     time_t t = time(nullptr);
    //     struct tm *ctime = localtime(&t);
    //     char leftbuffer[SIZE];
    //     snprintf(leftbuffer, sizeof(leftbuffer), "[%s][%d-%d-%d %d:%d:%d]", levelToString(level).c_str(),
    //              ctime->tm_year + 1900, ctime->tm_mon + 1, ctime->tm_mday,
    //              ctime->tm_hour, ctime->tm_min, ctime->tm_sec);

    //     va_list s;
    //     va_start(s, format);
    //     char rightbuffer[SIZE];
    //     vsnprintf(rightbuffer, sizeof(rightbuffer), format, s);
    //     // va_end(s);

    //     // æ ¼å¼ï¼šé»˜è®¤éƒ¨åˆ†+è‡ªå®šä¹‰éƒ¨åˆ†
    //     char logtxt[SIZE * 2];
    //     snprintf(logtxt, sizeof(logtxt), "%s %s\n", leftbuffer, rightbuffer);

    //     // printf("%s", logtxt); // æš‚æ—¶æ‰“å°
    //     printLog(level, logtxt);
    // }
    void printLog(int level, const std::string &logtxt)
    {
        switch (printMethod)
        {
        case Screen:
            std::cout << logtxt << std::endl;
            break;
        case Onefile:
            printOneFile(LogFile, logtxt);
            break;
        case Classfile:
            printClassFile(level, logtxt);
            break;
        default:
            break;
        }
    }
    void printOneFile(const std::string &logname, const std::string &logtxt)
    {
        std::string _logname = path + logname;
        int fd = open(_logname.c_str(), O_WRONLY | O_CREAT | O_APPEND, 0666); // "log.txt"
        if (fd < 0)
            return;
        write(fd, logtxt.c_str(), logtxt.size());
        close(fd);
    }
    void printClassFile(int level, const std::string &logtxt)
    {
        std::string filename = LogFile;
        filename += ".";
        filename += levelToString(level); // "log.txt.Debug/Warning/Fatal"
        printOneFile(filename, logtxt);
    }

    ~Log()
    {
    }
    void operator()(int level, const char *format, ...)
    {
        time_t t = time(nullptr);
        struct tm *ctime = localtime(&t);
        char leftbuffer[SIZE];
        snprintf(leftbuffer, sizeof(leftbuffer), "[%s][%d-%d-%d %d:%d:%d]", levelToString(level).c_str(),
                 ctime->tm_year + 1900, ctime->tm_mon + 1, ctime->tm_mday,
                 ctime->tm_hour, ctime->tm_min, ctime->tm_sec);

        va_list s;
        va_start(s, format);
        char rightbuffer[SIZE];
        vsnprintf(rightbuffer, sizeof(rightbuffer), format, s);
        va_end(s);

        // æ ¼å¼ï¼šé»˜è®¤éƒ¨åˆ†+è‡ªå®šä¹‰éƒ¨åˆ†
        char logtxt[SIZE * 2];
        snprintf(logtxt, sizeof(logtxt), "%s %s", leftbuffer, rightbuffer);

        // printf("%s", logtxt); // æš‚æ—¶æ‰“å°
        printLog(level, logtxt);
    }

private:
    int printMethod;
    std::string path;
};
//å¯å˜å‚æ•°å¿…é¡»è¦æœ‰è‡³å°‘ä¸€ä¸ªå…·ä½“çš„å‚æ•°
int sum(int n,...)
{
    //va_listå’Œva_startéƒ½æ˜¯å®
    va_list s;//char*
    va_start(s, n);//å®ä¾‹åŒ–æ˜¯ä»å³å‘å·¦è¿›è¡Œå®ä¾‹åŒ–çš„,sæ˜¯æœ€åä¸€ä¸ªè¢«å®ä¾‹åŒ–çš„,sæŒ‡å‘å¯å˜éƒ¨åˆ†
    int sum = 0;
    while(n)
    {
        sum += va_arg(s,int);//intèƒ½è¢«ä¼ é€’è¯æ˜äº†va_argæ˜¯å®,å› ä¸ºC/C++ä¸­ç±»å‹æ˜¯ä¸èƒ½ç”¨äºå¯å˜å‚æ•°ä¼ é€’çš„
        // printf("hello %d, hello %s, hello %c, hello %d,", 1, "hello", 'c', 123);
        n--;
    }
    va_end(s); // s = NULL;
    return sum;
}
```
**processa.cc**
```javascript
#include "share.hpp"
int main()
{
    int shmid = GetShareMemory();
    sleep(20);
    log(Debug,"process quit...");
    return 0;
}
```
**makefile**
```javascript
.PHONY:all
all:processa processb

processa:processa.cc
	g++ -o $@ $^ -g -std=c++11
processb:processb.cc
	g++ -o $@ $^ -g -std=c++11

.PHONY:clean
clean:
	rm -f processa processb

```
**share.hpp**
```javascript
#ifndef __SHARE_HPP__
#define __SHARE_HPP__
#include <iostream>
#include <string> 
#include <cstdlib> 
#include <sys/ipc.h>
#include <sys/shm.h>
#include <cstring>
#include <sys/types.h>
#include "log.hpp"

using namespace std;

const int size = 4096; //å…±äº«å†…å­˜å¤§å°
const string pathname = "/home/xpr"; //pathname
const int proj_id = 0x6666; //proj_id
Log log;
key_t GetKey()
{
    key_t k = ftok(pathname.c_str(),proj_id);
    if(k < 0)
    {
        log(Fatal,"ftok error: %s",strerror(errno));
        exit(1);
    }
    log(Info,"ftok success,key is: %d",k);
    return k;
}
//åˆ›å»º
int GetShareMemory()
{
    key_t k = GetKey();
    // int shmid = shmget(k,size,IPC_CREAT|IPC_EXCL);
    int shmid = shmget(k,size,IPC_CREAT);
    if(shmid < 0)
    {
        log(Fatal,"create share memory error: %s",strerror(errno));
        exit(1);
    }
    log(Info,"create share memory success,shmid: %d",shmid);
    return shmid;
}
#endif
```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/7b3bd3cf21cd414fba06d5d952ff4bba.png)
**ipcs -m**
æŸ¥ çœ‹ å…± äº« å†… å­˜ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/6595ddee1ef847ff8c18a2f2168bf1c1.png)
**ipcrm -m + shmid**
å…³ é—­ å…± äº« å†… å­˜ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/ae1886761b94465f8f4d8b0a4dcdc54e.png)

ç¨‹ åº å·² ç» ç»“ æŸï¼Œå…± äº« å†… å­˜ ä» ç„¶ å­˜ åœ¨ï¼Œæ“ ä½œ ç³» ç»Ÿ æ²¡ æœ‰ å…³ é—­ å…± äº« å†… å­˜ã€‚å…± äº« å†… å­˜ çš„ ç”Ÿ å‘½ å‘¨ æœŸ æ˜¯ éš å†… æ ¸ çš„ã€‚ç”¨ æˆ· ä¸ ä¸» åŠ¨ å…³ é—­ï¼Œå…± äº« å†… å­˜ ä¼š ä¸€ ç›´ å­˜ åœ¨ã€‚é™¤ é å†… æ ¸ é‡ å¯ æˆ– è€… ç”¨ æˆ· é‡Š æ”¾ã€‚å¦‚ æœ æ²¡ æœ‰ å…³ é—­ï¼Œå°± ä¼š å‘ ç”Ÿ å†… å­˜ æ³„ éœ²ã€‚
## key vs shmid
key ç”¨ æ¥ åœ¨ æ“ ä½œ ç³» ç»Ÿï¼ˆå†… æ ¸ï¼‰ å†… æ ‡ è¯† å”¯ ä¸€ æ€§ã€‚
shmid åª åœ¨ è¿› ç¨‹ å†…ï¼ˆç”¨ æˆ· å±‚ï¼‰ï¼Œç”¨ æ¥ è¡¨ ç¤º èµ„ æº çš„ å”¯ ä¸€ æ€§ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/332df6c4d34e410785f3136f12f92a68.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/5ca4aadf8a9741e9ae041004ed79d197.png)
## æƒ é™
å¯ ä»¥ åœ¨ åˆ› å»º å…± äº« å†… å­˜ æ—¶ è®¾ ç½® æƒ é™ã€‚
```javascript
int shmid = shmget(k,size,IPC_CREAT|IPC_EXCL|0666);
```
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/920e49cbc14b44e99462a1b5896d4b50.png)
## å¤§ å°
å…± äº« å†… å­˜ çš„ å¤§ å° å»º è®® è®¾ ç½® ä¸º 4096ï¼ˆ4KBï¼‰çš„ æ•´ æ•° å€ã€‚å¦‚ æœ è®¾ ç½® çš„ æ˜¯ 4097ï¼Œå® é™… ä¸Š æ“ ä½œ ç³» ç»Ÿ è®¾ ç½® çš„ æ˜¯ 4096 * 2 çš„ å¤§ å°ï¼Œä½† äº‹ å® ä¸Š åª èƒ½ ä½¿ ç”¨ 4097ï¼Œå¤š ä½™ çš„ ä¸ èƒ½ ä½¿ ç”¨ã€‚
```javascript
const int size = 4097; //å…±äº«å†…å­˜å¤§å°
```
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/9659eac32c6a428eacebe2a0524ecda7.png)
## å…³ è”
**shmat**
æŒ‚ æ¥ åœ¨ å…± äº« åŒºï¼Œè¿” å› å…± äº« å†… å­˜ çš„ èµ· å§‹ åœ° å€ã€‚
**shaddr**ï¼šæŒ‚ æ¥ åœ¨ å…± äº« åŒºï¼Œç”± æ“ ä½œ ç³» ç»Ÿ å†³ å®š æŒ‚ æ¥ åœ¨ å“ª é‡Œï¼Œè®¾ ä¸º NULLã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/6be4516e3b0f468b9dafd9a470cdbe05.png)
**processa.cc**
```javascript
#include "share.hpp"
int main()
{
    sleep(3);
    int shmid = CreateShm();//åˆ›å»ºå…±äº«å†…å­˜
    log(Debug,"create shm done");
    sleep(5);
    char* shmaddr = (char*)shmat(shmid,nullptr,0);//æŒ‚æ¥åœ¨å…±äº«åŒº
    log(Debug,"attach shm done");
    sleep(5);
    return 0;
}
```
å¦‚ ä¸‹ å›¾ æ‰€ ç¤ºï¼Œå·¦ è¾¹ çª— å£ é€š è¿‡ è¿ è¡Œ ç¨‹ åº æ¥ åˆ› å»º å…± äº« å†… å­˜ï¼Œå³ è¾¹ çª— å£ é€š è¿‡ è¿™ å¥ æŒ‡ ä»¤ æ¥ ç›‘ è§† å…± äº« å†… å­˜ã€‚
```javascript
while :;do ipcs -m | head -4 && ipcs -m | grep xpr;sleep 1;done
```
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/cced254b0942410ea0c220ac16e4228e.png)
æ€» å…± åˆ† ä¸º 3 ç§ æƒ… å†µï¼ŒæŒ‚ æ¥ å…± äº« å†… å­˜ ä¹‹ å‰ï¼Œå…± äº« å†… å­˜ çš„ å…³ è” æ•° ä¸º 0ï¼ŒæŒ‚ æ¥ ä¹‹ åï¼Œå…³ è” æ•° å˜ ä¸º 1ï¼Œæœ€ å ç¨‹ åº ç»“ æŸï¼ŒPCB åœ° å€ ç©º é—´ é¡µ è¡¨ å…¨ éƒ¨ é‡Š æ”¾ï¼Œå…³ è” æ•° å˜ ä¸º 0ã€‚
***
**shmadt**
 ç¨‹ åº å» é™¤ å…³ è”ï¼Œå‚ æ•° æ˜¯ **shmat** è¿” å› çš„ è™š æ‹Ÿ åœ° å€ï¼ˆèµ· å§‹ åœ° å€ï¼‰ã€‚å…± äº« å†… å­˜ æ˜¯ è¿ ç»­ çš„ï¼Œæœ‰ å± æ€§ è®° å½• ç€ å…± äº« å†… å­˜ çš„ å¤§ å°ï¼Œæ‰ èƒ½ é€š è¿‡ èµ· å§‹ åœ° å€ å’Œ å¤§ å° æ¥ é‡Š æ”¾ å…± äº« å†… å­˜ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/4a35baed92a74fa8a0be223389265e02.png)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/eddcabe917dd41e0af4e75fab10b4736.png)
```javascript
#include "share.hpp"
int main()
{
    sleep(3);
    int shmid = CreateShm();//åˆ›å»ºå…±äº«å†…å­˜
    log(Debug,"create shm done");
    sleep(5);
    char* shmaddr = (char*)shmat(shmid,nullptr,0);//æŒ‚æ¥åœ¨å…±äº«åŒº
    log(Debug,"attach shm done,shmaddr:0x%x",shmaddr);
    sleep(5);
    shmdt(shmaddr);
    sleep(5);
    return 0;
}
```
***
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/5d364bb861064a5fb45661d33d7c7ca7.png)
**shmctl**
é‡Š æ”¾ å…± äº« å†… å­˜ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/795174b4ab8a46e9911800604f07de24.png)

# ä¸‰ã€æ€» ç»“
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ¬ æ–‡ è¦† ç›– äº† é™ æ€ åº“ï¼ˆ.o æ‰“ åŒ…ã€Makefile æ„ å»ºã€-I/-L/-l é“¾ æ¥ï¼‰ä¸ åŠ¨ æ€ åº“ï¼ˆ-fPIC/-shared ç¼– è¯‘ã€4 ç§ åŠ  è½½ é—® é¢˜ è§£ å†³ æ–¹ æ¡ˆï¼‰çš„ æ ¸ å¿ƒ å†… å®¹ã€‚é™ æ€ åº“ åµŒ å…¥ ç¨‹ åºã€ç‹¬ ç«‹ ä½† ä½“ ç§¯ å¤§ï¼ŒåŠ¨ æ€ åº“ å…± äº« æ¨¡ å—ã€è½» é‡ ä½† éœ€ ä¾ èµ– ç³» ç»Ÿï¼Œéœ€ æŒ‰ éœ€ é€‰ æ‹©ã€‚å ç»­ å¯ å° è¯• å° è£… é€š ç”¨ æ¨¡ å— ä¸º åº“ï¼Œæˆ– ç ” ç©¶ ç‰ˆ æœ¬ ç®¡ ç†ï¼Œè¿› ä¸€ æ­¥ æ å‡ å¼€ å‘ æ•ˆ ç‡ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d4027f37013e40408f63251e2f86090c.gif)