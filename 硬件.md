# 一、硬 件
## 1、文 件
1. `磁 盘 上 存 储 文 件 = 存 文 件 内 容 + 存 文 件 的 属 性`
2. 文 件 没 有 被 打 开 是 在 磁 盘 中 存 储 的。关 心 路 径 问 题、存 储 问 题 、获 取 问 题（文 件 属 性 + 内 容）、效 率 问 题。
3. 文 件 的 内 容 采 用 数 据 块 形 式 的 存 储，文 件 的 属 性 - - - inode，inode 是 128 字 节 的 数 据 块，存 储 着 文 件 的 属 性。
***
## 2、磁 盘
### （1）磁 盘 的 物 理 构 成
1. Linux 的 文 件 在 磁 盘 中 存 储，是 将 文 件 的 属 性 和 内 容 分 开 存 储 的。
2. 磁 盘 是 永 久 性 存 储 介 质，容 量 大，便 宜。混 盘 中 一 部 分 是 ssd，另 一 部 分 是 磁 盘。
3. 磁 盘 是 电 脑 上 唯 一 的 机 械 设 备，属 于 外 设，效 率 慢。
4. 盘 面 高 速 旋 转，磁 头 左 右 摆 动，磁 头 是 一 面 一 个，一 个 盘 片 有 两 个 磁 头。磁 头 和 盘 面 不 接 触，磁 头 悬 浮 在 盘 片 上。数 据 在 磁 盘 中 是 以 二 进 制 的 形 式 存 储 的。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/146f08eb8b454a158f39540fd92032b9.png)
***
### （2）磁 盘 的 存 储 构 成

**磁 头**：每 个 磁 片 的 正 反 两 面 各 有 一 个 磁 头，用 于 读 写 数 据。 
**磁 道**：磁 片 表 面 被 划 分 为 同 心 圆 环，每 个 圆 环 称 为 一 个 磁 道。 
**扇 区**：每 个 磁 道 被 进 一 步 划 分 为 多 个 扇 形 区 域，每 个 区 域 称 为 一 个 扇 区，通 常 每 个 扇 区 的 容 量 为 512 字 节 或 者 4KB。
**柱 面**：由 所 有 磁 片 中 半 径 相 同 的 同 心 磁 道 构 成，形 成 一 个 柱 面 的 形 状。 
**盘 片**：硬 盘 由 一 个 或 多 个 盘 片 组 成，每 个 盘 片 的 两 面 都 可 以 存 储 数 据。 

1. 每 一 个 盘 面 都 是 由 同 心 圆 构 成，它 是 有 厚 度 的。
2. 每 一 个 同 心 圆 被 称 为 磁 道，数 据 在 磁 道 上 存 储。
3. 磁 盘 被 访 问 的 基 本 单 位 是 扇 区，可 以 将 磁 盘 看 成 是 有 无 数 个 扇 区 构 成 的 存 储 介 质。
4. 磁 头 左 右 摆 动 可 以 定 位 磁 道 和 柱 面，磁 盘 高 速 旋 转 可 以 定 位 扇 区。磁 盘 的 机 械 运 动 越 少，访 问 效 率 越 高，机 械 运 动 越 多，访 问 效 率 越 低。软 件 设 计 时 一 定 要 将 相 关 数 据 放 在 一  起 用 来 提 高 磁 盘 的 访 问 效 率。
5. 数 据 存 到 磁 盘：确 定 盘 面 - - -> 定 位 磁 头 - - - > 确 定 磁 道 - - - > 确 定 扇 区。
6. 磁 盘 通 过 磁 头、柱 面 和 扇 区 定 位 磁 盘 中 某 一 个 扇 区 的 方 式 称 作 CHS 寻 址 方 式。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/0f98aec6bc244ed199e2dc3d9cfdfe0e.png)
### （3）磁 盘 的 逻 辑 结 构
类 似 于 磁 带，可 以 将 磁 盘 延 展 开，逻 辑 上 它 是 线 性 的。磁 盘 可 以 看 做 是 以 扇 区 为 基 本 单 位 的 数 组，任 意 一 个 扇 区 都 有 下 标。逻 辑 扇 区 地 址 使 用 LBA 标 识，磁 盘 的 物 理 地 址 使 用 CHS 标 识，磁 盘 的 逻 辑 扇 区 地 址 可 以 和 物 理 地 址 相 互 转 换。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5cfcc6ff385146fe8bdc1c6201ac061c.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/2b0507fec02b4f25ab8e3ab9cbd58ee4.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d8d3815761c44defaa304ac54e4aea6b.png)
***
## 3、光 盘
光 盘 是 光 学 数 据 存 储 介 质，核 心 原 理 是 通 过 激 光 在 盘 片 表 面 的 “坑 点” 与 “平 面” 之 间 的 反 射 差 异 来 记 录 和 读 取 数 字 信 息。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/8398f4d1b736430b9291dd836fef0af7.png)
***
## 4、硬 件
整 个 计 算 机 当 中，不 仅 仅 CPU 有 寄 存 器，其 他 设 备（外 设）磁 盘 当 中 也 有 寄 存 器。磁 盘 当 中 有 控 制 寄 存 器、数 据 寄 存 器 和 状 态 寄 存 器。硬 件 是 可 以 被 访 问 的。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/7920c03b978b4f139349bc0a33ae5322.png)
***
# 二、ext2 文 件 系 统
## 1、思 想
**分 治 思 想**：将 大 规 模、复 杂 的 磁 盘 管 理 问 题 拆 解 为 若 干 个 规 模 更 小、逻 辑 更 独 立、易 于 处 理 的 子 问 题，通 过 逐 个 解 决 子 问 题，最 终 实 现 对 整 个 磁 盘 的 高 效 管 理。
## 2、基 本 组 成
1. **Block Group**：ext2 文 件 系 统 会 根 据 分 区 的 大 小 划 分 为 数 个 Block Group。而 每 个 Block Group 都 有 着 相 同 的 结 构 组 成。

2. **超 级 块（Super Block）**：包 含 整 个 分 区 的 基 本 使 用 情 况，不 一 定 在 每 个 组 里 存 在。记 录 的 信 息 主 要 有：block 和 inode 的 总 量，未 使 用 的 block 和 inode 的 数 量，一 个 block 和 inode 的 大 小，最 近 一 次 挂 载 的 时 间，最 近 一 次 写 入 数 据 的 时 间，最 近 一 次 检 验 磁 盘 的 时 间 等 其 他 文 件 系 统 的 相 关 信 息。Super Block 的 信 息 被 破 坏，可 以 说 整 个 文 件 系 统 结 构 就 被 破 坏 了。 

3. **GDT，Group Descriptor Table**：块 组 描 述 符，描 述 块 组 属 性 信 息。

4. **块 位 图（Block Bitmap）**：Block Bitmap 中 记 录 着 Data Block 中 哪 个 数 据 块 已 经 被 占 用，哪 个 数 据 块 没 有 被 占 用。比 特 位 的 位 置 和 块 号 映 射 起 来，比 特 位 的 内 容 表 示 该 块 是 否 被 使 用。

5. **inode 位 图（inode Bitmap）**：每 个 bit 表 示 一 个 inode 是 否 空 闲 可 用。比 特 位 的 位 置 和 inode 的 编 号 映 射 起 来。比 特 位 的 内 容 的 inode 是 否 是 有 效 的。

6. **i 节 点 表**：存 放 文 件 属 性 如 文 件 大 小，所 有 者，最 近 修 改 时 间 等，1 个 文 件 1 个 inode。1 个 块 只 有 自 己 的 数 据。

7. **数 据 区**：存 放 文 件 内 容，以 块 的 形 势 呈 现。常 见 的 大 小 是 4KB。

8. 在 Linux 中，文 件 的 属 性 当 中，不 包 含 文 件 的 名 称，包 含 文 件 的 编 号。标 识 文 件 用 的 是 inode 编 号，可 以 通 过 `ls -i` 来 查 找 文 件 的 编 号。
9. 每 一 个 分 区 在 被 使 用 之 前，都 必 须 提 前 先 将 部 分 文 件 系 统 的 属 性 信 息 提 前 设 置 进 对 应 的 分 区 中，方 便 后 续 使 用 这 个 分 区 或 者 分 组。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fa514abf49104c06bb4030e5e91b7be0.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/f791d0b3d64441079255a03f465213d8.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a57cff1fe620436fa90d3a7be12a1891.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/384523aa2ba448059565cd8d604d6d15.png)
## 2、inode
Linux 系 统 中，一 个 文 件，一 个 inode，每 一 个 inode 都 有 自 己 的 inode 编 号（只 在 自 己 的 分 区 内 全 部 有 效）,inode 的 设 置 是 以 分 区 为 单 位 的，不 能 跨 分 区。
inode 表 示 文 件 的 属 性，文 件 名 并 不 属 于 inode 内 的 属 性。

## 3、删 除 文 件
删 除 文 件 不 需 要 将 块（文 件 内 容 清 空）。删 除 文 件 时，先 得 到 inode 编 号，根 据 编 号 在 inode Bitmap 中 判 断 位 图 是 否 有 效，然 后 去 inode Table 读 取 属 性 获 得 inode 读 取 和 数 据 块 的 映 射 关 系，获得 块 号，在 BlockBitmap 中 将 块 号 清 零，然 后 在 inodeBitmap 中 由 1 置 为 0，这 样 整 个 文 件 就 被 清 理 掉 了。删 除 文 件 只 和 BlockBitmap 和 inode Bitmap 有 关，和 inode Table 与 DataBlocks 没 有 关 系。
拷 贝 特 别 慢，删 除 特 别 快。
## 4、查 看 文 件 属 性
**stat**
查 看 文 件 的 属 性。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/7e98e8840ef0486883f4c92a1bcc118f.png)
**ls -il**
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/3ab19481470c46ad931743e81fc1dc4d.png)
## 5、重 新 认 识 目 录
目 录 是 文 件，目 录 有 自 己 独 立 的 inode，目 录 也 要 有 自 己 的 属 性。目 录 有 内 容 有 数 据 块，目 录 的 内 容 里 面 放 该 目 录 下 文 件 的 文 件 名 和 对 应 文 件 的 inode 的 映 射 关 系。

**为 什 么 同 一 个 目 录 下 不 能 有 同 名 文 件？**
因 为 通 过 文 件 名 来 找 文 件 对 应 的 inode，如 果 同 名 冲 突，文 件 系 统 无 法 找 到 指 定 的 文 件 了。

**在 一 个 目 录 下，权 限 没 有 w，无 法 创 建 文 件**
因 为 没 有 权 限 访 问 目 录 文 件，即 使 将 文 件 创 建 出 来 也 无 法 写 入 目 录 的 数 据 块 中。

**目 录 下，没 有 读 权 限，无 法 查 看 文 件**
因 为 要 先 读 取 目 录 文 件，找 到 目 录 文 件 的 inode，然 后 才 能 读 取 文 件，如 果 没 有 读 权 限，目 录 不 让 读，无 法 查 看 文 件。

**目 录 下，没 有 x 权 限，无 法 进 入 目 录**
因 为 要 先 进 入 目 录 文 件，找 到 目 录 文 件 的 inode，然 后 才 能 读 取 文 件，如 果 没 有 进 入 权 限，目 录 不 让 进，无 法 进 入 目 录。

**查 找 目 录 的 inode**
先 找 到 根 目 录，通 过 绝 对 路 径 和 相 对 路 径，在 根 目 录 的 数 据 块 中 找 到 目 录 的 数 据，因 此，查 找 目 录 的 inode 时 应 该 查 找 目 录 的 路 径，系 统 会 对 目 录 的 路 径 进 行 缓 存，需 要 的 时 候 进 行 查 找 目 录。

***