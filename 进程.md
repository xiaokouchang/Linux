# 管 理 进 程
## kill
`kill -9 PID`
杀 死（终 止）进 程。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/c7c40c0c44ad449da8797b01a9f97fd6.png)
`ps 的 本 质 是 遍 历 链 表，然 后 得 到 所 有 进 程 的 相 关 信 息。`
## 系 统 调 用 接 口 
### getpid
获 得 进 程 的 标 识 符。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ea62bb2635f84dd1b0377687e3561d55.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/2ec92113680248a2b63247e0f1b7f1b4.png)
使 用 `while :;do ps ajx | head -1 && ps ajx | grep test_debug;echo "--------------------------------------------------------------------------";sleep 1;done` 这 条 指 令 可 以 不 断 获 取 进 程 的 运 行 情 况。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/27c00ac5fed642828e5c6a457c246079.png)
### 父 进 程 - - - PPID
`getppid`

PPID 就 是 子 进 程 用 来 记 录 父 进 程 的 唯 一 标 识 符，`getppid` 可 以 得 到 父 进 程 的 标 识 符。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e73f9b12e1bc4c12906ea586255895ff.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/1a9ef7fac7e54466931b2e82499eae30.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/4b713b84f9ab469a858afda459b98214.png)
***
### bash
[命 令 行 解 释 器](https://blog.csdn.net/2301_78847073/article/details/144883662?spm=1001.2014.3001.5501)

运 行 进 程 时，命 令 行 解 释 器 会 将 指 令 解 释 成 bash 的 子 进 程，由 子 进 程 执 行 对 应 的 命 令，进 程 出 问 题 不 影 响 对 应 的 bash 进 程。每 一 条 指 令 的 运 行 都 属 于 bash 的 子 进 程。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/da76968c07cc4ae68591233a06c4ea7f.png)
## 通 过 系 统 调 用 创 建 进 程
### fork
创 建 进 程
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/11d6fac3f7bc475b9e558f6da6a0442f.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d78e337404f5439f86fe63f7426918b2.png)
***
`没 有 fork`
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/189f56917c2d4b62a603b7c56124cd62.png)
`有 fork`
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/7bf3e8715ce44f1ba6f389f0019028f8.png)
由 这 两 张 图 片 不 难 可 以 看 出，`fork` 后 面 的 代 码 被 执 行 了 2 次。因 为 fork 之 前 是 1 个 进 程，fork 之 后 是 2 个 进 程。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a1c6d7d4ba7f470c9ce6f1a42fd42653.png)
`fork 给 父 进 程 返 回 PID 为 子 进 程 返 回 0`
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/411ffa20372f499494f97a388703c041.png)
<font color=orange>结 论</font>
1. fork > 0 和 fork = 0 同 时 存 在。
2. 父 子 关 系 成 立。
3. fork 之 后 的 代 码 是 2 个 进 程。这 里 存 在 2 个 进 程。
### 创 建 进 程 的 方 式
1. `./ 运 行 程 序` - - - 指 令 级 别 创 建 进 程
2. `fork` - - - 代 码 层 面 创 建 进 程。
### 创 建 子 进 程 的 步 骤
1. 创 建 子 进 程 PCB。
2. 填 充 PCB 对 应 的 内 容。
3. 让 子 进 程 和 父 进 程 指 向 同 样 的 代码
4. 父 子 进 程 都 有 独 立 的 task_struct，可 以 被 CPU 调 度 运 行 了。
### 四 个 问 题
1. 为 什 么 fork 要 给 子 进 程 返 回 0，给 父 进 程 返 回 子 进 程 pid？
`（1）为 了 让 fork 之 后 通 过 if 来 执 行 不 同 的 代 码 片 段。`
`（2）返 回 不 同 的 返 回 值，是 为 了 区 分 让 不 同 的 执 行 流 执 行 不 同 的 代 码 块。`
`（3）fork 之 后 的 父 子 进 程 代 码 共 享。原 因 是 因 为 父 进 程 指 向 的 代 码 和 数 据，子 进 程 此 时 没 有 执 向 代 码，子 进 程 只 能 指 向 和 父 进 程 一 样 的 代 码 和 数 据。`
<font color=orange>原 因：1 个 父 进 程 有 多 个 子 进 程，但 多 个 父 进 程 只 有 1 个 子 进 程，为 了 明 确 父 进 程 要 控 制 哪 一 个 子 进 程。</font>
2. 一 个 函 数 是 如 何 做 到 返 回 2 次 的 ？如 何 理 解？
（1）`进 程 = 内 核 数 据 结 构 + 代 码 和 数 据`
（2）创 建 子 进 程 的 本 质 是 进 程 当 中 多 了 1 个 选 项。
（3）为 了 让 父 和 子 进 程 执 行 不 同 的 事 情，需 要 想 办 法 让 父 和 子 进 程 执 行 不 同 的 代 码 块。即 让 fork 具 有 不 同 的 返 回 值。
（4）return 语 句 被 父 和 子 进 程 分 别 执 行，即 return 语 句 被 父 子 进 程 共 享。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/4cb23cf6c4554dba862a775025bef26e.png)
3. 一 个 变 量 怎 么 会 有 不 同 的 内 容？如 何 理 解?

（1）因 为 数 据 可 能 被 修 改，所 以 不 能 让 父 进 程 和 子 进 程 共 享 同 一 份 数 据。
（2）任 何 平 台，进 程 运 行 具 有 独 立 性。
（3）操 作 系 统 会 开 辟 空 间 让 子 进 程 去 新 的 空 间 修 改 被 称 为 数 据 层 面 的 写 时 拷 贝。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/38cfb751ca764fcbb44ac4fea6627a08.png)

4. fork 函 数 究 竟 在 干 什 么？干 了 什 么？
（1）创 建 子 进 程，为 子 进 程 创 建 了 PCB，用 父 进 程 对 应 的 字 段 初 始 化 子 进 程，并 且 让 父 子 进 程 实 现 代 码 的 共 享。
（2）代 码 加 载 到 内 存 中 不 能 修 改，只 能 改 代 码 中 的 数 据。

5. 如 果 父 子 进 程 被 创 建 好，谁 先 运 行 由 调 度 器 决 定。挑 选 进 程 工 作 由 调 度 器 决 定 保 证 进 程 公 平 调 度。

6. 子 进 程 是 由 Bash 中 的 fork 创 建 的，子 进 程 还 可 以 继 续 fork() 创 建 自 己 的 子 进 程。
## 进 程 的 状 态
### 操 作 系 统 中 进 程 的 状 态
运 行（R）：进 程 在 CPU 上 排 队，所 有 处 于 运 行 队 列 中 的 进 程 称 为 运 行 状 态。
阻 塞：
挂 起：
### Linux 系 统 中 进 程 的 状 态
**R 运 行 状 态（R）**: 并 不 意 味 着 进 程 一 定 在 运 行中，它 表 明 进 程 要 么 是 在 运 行 中 要 么 在 运 行 队 列 里。
**S 睡 眠 状 态（S)**：意 味 着 进 程 在 等 待 事 件 完 成（这 里 的 睡 眠 有 时 候 也 叫 做 可 中 断 睡 眠）
**D 磁 盘 休 眠 状 态（D）**：有 时 候 也 叫 不 可 中 断 睡 眠 状 态，在 这 个 状 态 的 进 程 通 常 会 等 待 IO 的 结 束。
**T 停 止 状 态（S）**：可 以 通 过 发 送 SIGSTOP 信 号 给 进 程 来 停 止（T）进 程。这 个 被 暂 停 的 进 程 可 以 通 过 发 送 SIGCONT 信 号 让 进 程 继 续 运 行。
**X 死 亡 状 态（D）**：这 个 状 态 只 是 一 个 返 回 状  态，你 不 会 在 任 务 列 表 里 看 到 这 个 状 态。