# 一、进 程 的 创 建
## 1、fork 函 数 初 识
在 linux 中 fork 函 数 是 非 常 重 要 的 函 数，它 从 已 存 在 进 程 中 创 建 一 个 新 进 程。新 进 程 为 子 进 程，而 原 进 程 为 父 进 程。
进 程 调 用 fork，当 控 制 转 移 到 内 核 中 的 fork 代 码 后，内 核 做：
1. 分 配 新 的 内 存 块 和 内 核 数 据 结 构 给 子 进 程
2. 将 父 进 程 部 分 数 据 结 构 内 容 拷 贝 至 子 进 程，页 表 代 码 和 数 据 可 以 是 完 全 一 样 的。
3. 添 加 子 进 程 到 系 统 进 程 列 表 当 中
4. fork 返 回，开 始 调 度 器 调 度
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/0a96941c4e3f43b790991ad9e0259dbd.png)
```javascript
#include<stdio.h>
#include<unistd.h>
#include<stdlib.h>
int main()
{
    printf("pid:%d Before!\n",getpid());
    fork();
    printf("pid:%d After!\n",getpid());
    return 0;
}
```
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/520e01a1206645b5ae00e16f9d50e2cb.png)
fork 之 前 父 进 程 独 立 执 行，fork 之 后，父 子 两 个 执 行 流 分 别 执 行。

==注 意==
fork 之 后，谁 先 执 行 完 全 由 调 度 器 决 定。
***
## fork 函 数 返 回 值
子 进 程 返 回 0，父 进 程 返 回 的 是 子 进 程 的 pid。
***
## 写 时 拷 贝
父 子 代 码 共 享，父 子 再 不 写 入 时，数 据 也 是 共 享 的，当 任 意 一 方 试 图 写 入，便 以 写 时 拷 贝 的 方 式 各 自 一 份 副 本。

<font color=orange>写 时 拷 贝 本 质 是 写 的 时 候 再 用，是 一 种 延 时 申 请，按 需 申 请。</font>

具 体 见 下 图:
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/de62b0758ccb4217b91e82096d3edd13.png)
无 论 是 父 进 程 还 是 子 进 程，如 果 想 要 写 入，会 将 父 进 程 中 可 写 的 部 分 改 成 只 读，子 进 程 继 承 时 也 是 只 读 状 态，暂 时 是 只 读 状 态。针 对 这 种 情 况，操 作 系 统 不 做 异 常 处 理，如 果 想 要 写 入 数 据，会 将 页 表 对 应 的 区 域 重 新 映 射，然 后 进 行 写 时 拷 贝，这 样 就 能 访 问 原 来 可 写 的 区 域。

***